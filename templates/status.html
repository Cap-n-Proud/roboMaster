<!DOCTYPE html>
<html>

  <head>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/clocklet@0.3.0/css/clocklet.min.css">
    <script src="https://cdn.jsdelivr.net/npm/clocklet@0.3.0"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/3.0.4/socket.io.js" integrity="sha512-aMGMvNYu8Ue4G+fHa359jcPb1u+ytAF+P2SCb+PxrjCdO3n3ZTxJ30zuH39rimUggmTwmh2u7wvQsDTHESnmfQ==" crossorigin="anonymous"></script>

    <script>
      /* `window.clocklet` object is available */
    </script>

    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Changa|Frank+Ruhl+Libre:500">


    <style>
      .clocklet-options-1 {
        font-family: Changa, sans-serif;
        border-radius: 50%;
      }
    </style>

    <style>
      .clocklet-options-2 {
        font-family: "Frank Ruhl Libre", serif;
        font-weight: 500;
      }
    </style>
  </head>
  <!-- https://www.w3schools.com/howto/tryit.asp?filename=tryhow_css_display_element_hover -->

  <body>
    <table id="trees">
      <tr>
        <td></td>
        <td></td>
        <td></td>
      </tr>
      <tr>
        <td></td>
        <td></td>
        <td></td>
      </tr>

    </table>
    <div id="divid"> </div>
    <div id="myData"></div>
    <script>
      //Calls functions to load defaults and info.
      document.addEventListener("DOMContentLoaded", function() {

        createCheckBoxes();
        getStatus();
        // t();
      });

      //Get the button
      var mybutton = document.getElementById("myBtn");
      mybutton.style.display = "block";

      // When the user scrolls down 20px from the top of the document, show the button
      window.onscroll = function() {
        scrollFunction()
      };

      function scrollFunction() {
        if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
          mybutton.style.display = "block";
        } else {
          mybutton.style.display = "none";
        }
      }

      // When the user clicks on the button, scroll to the top of the document
      function topFunction() {
        document.body.scrollTop = 0;
        document.documentElement.scrollTop = 0;
      }


      function postCommand(cmd) {
        const URL = `${window.origin}/arduinoCommand`
        // post body data
        const command = {
          command: cmd
        };

        // request options
        const options = {
          method: 'POST',
          body: JSON.stringify(command),
          headers: {
            'Content-Type': 'application/json'
          }
        }

        // send POST request
        fetch(URL, options)
          .then(res => res.json())
        //.then(res => console.log(res));
      }

      function getCurrentProgram() {
        fetch('http://127.0.0.1:5000/currentProgram')
          .then(function(response) {
            return response.json();
          })
          .then(function(data) {
            const keys = Object.keys(data);
            var ele = document.getElementById('currentProgramLabel');
            keys.forEach((key, index) => {
              // console.log(`${key}: ${data[key]}`);
              ele.innerHTML = ele.innerHTML +
                '<tr><td>' + key + '</td><td>' + data[key] + '</td><td></td></tr>';
            });
            for (var i = 0; i < data; i++) {
              // POPULATE SELECT ELEMENT WITH JSON.
              ele.innerHTML = ele.innerHTML +
                '<tr><td>' + data[i] + '</td></tr>';
            }
          })
      }

      function hexTorgb(hex) {
        return ['0x' + hex[1] + hex[2] | 0, '0x' + hex[3] + hex[4] | 0, '0x' + hex[5] + hex[6] | 0];
      }

      function R_G_BtoHEX(red, green, blue) {
        red = red < 0 ? 0 : red > 255 ? 255 : red;
        green = green < 0 ? 0 : green > 255 ? 255 : green;
        blue = blue < 0 ? 0 : blue > 255 ? 255 : blue;

        return "#" +
          ("0" + parseInt(red, 10).toString(16)).slice(-2) +
          ("0" + parseInt(green, 10).toString(16)).slice(-2) +
          ("0" + parseInt(blue, 10).toString(16)).slice(-2);
      }

      function createCheckBox(table, ID, plantID, plantName) {
        var hold = document.getElementById(table);
        var checkbox = document.createElement('input');
        checkbox.type = "checkbox";
        checkbox.name = ID;
        checkbox.id = ID;
        var label = document.createElement('label');
        var tn = document.createTextNode(plantName);
        label.htmlFor = ID;
        label.appendChild(tn);
        hold.appendChild(label);
        hold.appendChild(checkbox);
      }

      function createCheckBoxes() {

        var ele = document.getElementById('trees');
        var ID = "1"
        var plantID = "12"
        var plantName = "Straberry"
        for (var i = 0; i < 10; i++) {
          // POPULATE SELECT ELEMENT WITH JSON.
          ele.innerHTML = ele.innerHTML +
            // '<tr><td> ' + createCheckBox(table, i, "32", "Straberry") + ' </td><td> ' + createCheckBox(table, i, "32", "Straberry") + ' </td><td> ' + createCheckBox(table, i, "32", "Straberry") + ' </td></tr>'
            '<tr><td> ' + '<input type = "checkbox" id = "' + ID + '" value = "' + plantID + '" />' + '<label for = "' + ID + '">' + plantName + '</label>' + ' </td><td> ' + '<input type = "checkbox" id = "' + ID + '" value = "' + plantID + '" />' +
            '<label for = "' + ID + '">' + plantName + '</label>' + ' </td><td> ' + '<input type = "checkbox" id = "' + ID + '" value = "' + plantID + '" />' + '<label for = "' + ID + '">' + plantName + '</label>' + ' </td></tr>'


          ;
        }

      }



      function getStatus() {
        fetch('http://127.0.0.1:5000/api/s')
          .then(function(response) {
            return response.json();
          })
          .then(function(data) {

            // for (var t = 0; t < Object.keys(data.towers).length; i++) {
            //   for (var l = 0; l < Object.keys(data.towers[t]).length; i++) {
            //
            //
            //     for (var p = 0; p < Object.keys(data.towers[t]..pods).length; i++) {
            //       console.log(data.towers[0].pods[0].plantName)
            //       // var product = catalog.products[i];
            //       //                 var productName = product.name;
            //       //                 for(var j = 0; j < product.versions.length; j++)
            //       //                 {
            //       //                     var version = product.versions[j];
            //       //                 }
            //     }
            //   }
            // }
            // var obj = graph.sparkData[i];
            // console.log(obj);
            // var crunchifyName;
            // var crunchifyValue;
            //
            // document.writeln("<td>");
            // document.writeln("<table border='0'  width=100 >");
            //
            // for (var key in obj) {
            //
            //   obj = data.towers
            //   for (var key in data) {
            //
            // }
            // https://stackoverflow.com/questions/19032954/why-is-jsonobject-length-undefined
            // console.log(data.lenght)
            // console.log(Object.keys(data.towers).length)
            //
            console.log(data.towers[0].tower01[0].level)
            // console.log(data.towers[0].tower01[1].pods[0].plantName)
            // console.log(data.towers[0].level)
          })
      }

      // https://crunchify.com/how-to-iterate-through-jsonarray-in-javascript/
      function t(sparkData) {
        var graph = {
          "sparkData": [{
            "one": [97, 5, 69, 35, 28, 52, 51, 55]
          }, {
            "two": [96, 63, 18, 55, 13, 47, 77, 64]
          }, {
            "three": [94, 75, 83, 44, 43, 86, 68, 26]
          }]
        }

        var i = 0
        document.writeln("<br><br><div align='center'><table border='1'><tr>");

        for (var i = 0; i < graph.sparkData.length; i++) {
          var obj = graph.sparkData[i];
          console.log(obj);
          var crunchifyName;
          var crunchifyValue;

          document.writeln("<td>");
          document.writeln("<table border='0'  width=100 >");

          for (var key in obj) {
            crunchifyName = key;
            crunchifyValue = obj[key].toString(); +
            document.writeln("<tr><td><B>" + crunchifyName +
              ":  </B></td><td width=50>" + crunchifyValue +
              "</td></tr>");
            document.writeln("</table>");
            document.writeln("</td>");

          }
        }
        document.writeln("</tr></table></div>");
      }







      var socket = io();


      $(document).ready(function() {
        // Connect to the Socket.IO server.
        // The connection URL has the following format, relative to the current page:
        //     http[s]://<domain>:<port>[/<namespace>]

        // Event handler for new connections.
        // The callback function is invoked when a connection with the
        // server is established.
        socket.on('connect', function() {
          socket.emit('my_event', {
            data: 'I\'m connected!'
          });
          console.log("connected!")
        });




        // Event handler for server sent data.
        // The callback function is invoked whenever the server emits data
        // to the client. The data is then displayed in the "Received"
        // section of the page.
        socket.on('my_response', function(msg, cb) {
          $('#log').append('<br>' + $('<div/>').text('Received #' + msg.count + ': ' + msg.data).html());
          console.log("received")
          if (cb)
            cb();
        });
        socket.on('info', function(msg, cb) {
          document.getElementById("infoBox").innerHTML = msg.replace("I,", "")
          if (cb)
            cb();
        });


        var start_time;
        window.setInterval(function() {
          start_time = (new Date).getTime();
          socket.emit('my_ping');
        }, 1000);

        $('form#disconnect').submit(function(event) {
          socket.emit('disconnect_request');
          return false;
        });
      });
    </script>
  </body>

</html>